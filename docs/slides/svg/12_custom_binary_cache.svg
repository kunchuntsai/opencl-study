<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1920 1080">
  <defs>
    <marker id="arrow" markerWidth="12" markerHeight="9" refX="11" refY="4.5" orient="auto">
      <polygon points="0 0, 12 4.5, 0 9" fill="#ffbb62"/>
    </marker>
    <marker id="arrow-gray" markerWidth="12" markerHeight="9" refX="11" refY="4.5" orient="auto">
      <polygon points="0 0, 12 4.5, 0 9" fill="#666666"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1920" height="1080" fill="#ffffff"/>

  <!-- Title -->
  <text x="960" y="55" text-anchor="middle" font-family="Arial, sans-serif" font-size="48" font-weight="bold" fill="#666666">Custom Binary Cache Mechanism</text>
  <text x="960" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" fill="#8b7355">CL Extension API with hardware-specific binary caching</text>

  <!-- ============ LEFT: Standard Cache (for comparison) ============ -->
  <rect x="80" y="130" width="520" height="480" rx="20" fill="#fff8f0" stroke="#cc9966" stroke-width="3"/>

  <!-- Header -->
  <rect x="80" y="130" width="520" height="60" rx="20" fill="#cc9966"/>
  <rect x="80" y="160" width="520" height="30" fill="#cc9966"/>
  <text x="340" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#fff">Standard OpenCL Cache</text>
  <text x="340" y="220" text-anchor="middle" font-family="monospace" font-size="16" fill="#8b7355">host_type: "standard"</text>

  <!-- Standard flow boxes -->
  <rect x="120" y="245" width="440" height="50" rx="8" fill="#fff" stroke="#cc9966" stroke-width="2"/>
  <text x="340" y="278" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#666666">1. Load kernel.cl source</text>

  <line x1="340" y1="295" x2="340" y2="315" stroke="#cc9966" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="120" y="320" width="440" height="50" rx="8" fill="#fff" stroke="#cc9966" stroke-width="2"/>
  <text x="340" y="353" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#666666">2. Check hash (CacheKernelIsValid)</text>

  <line x1="340" y1="370" x2="340" y2="390" stroke="#cc9966" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="120" y="395" width="440" height="50" rx="8" fill="#ffe4c4" stroke="#cc9966" stroke-width="2"/>
  <text x="340" y="428" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#cc8800">3. clBuildProgram (JIT compile)</text>

  <line x1="340" y1="445" x2="340" y2="465" stroke="#cc9966" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="120" y="470" width="440" height="50" rx="8" fill="#fff" stroke="#cc9966" stroke-width="2"/>
  <text x="340" y="503" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#666666">4. Save {kernel}.bin + .hash</text>

  <line x1="340" y1="520" x2="340" y2="540" stroke="#cc9966" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="120" y="545" width="440" height="50" rx="8" fill="#ffe4c4" stroke="#cc9966" stroke-width="2"/>
  <text x="340" y="578" text-anchor="middle" font-family="monospace" font-size="16" fill="#cc8800">clEnqueueNDRangeKernel()</text>

  <!-- ============ RIGHT: Custom Binary Cache ============ -->
  <rect x="680" y="130" width="1160" height="480" rx="20" fill="#fff8f0" stroke="#ffbb62" stroke-width="3"/>

  <!-- Header -->
  <rect x="680" y="130" width="1160" height="60" rx="20" fill="#ffbb62"/>
  <rect x="680" y="160" width="1160" height="30" fill="#ffbb62"/>
  <text x="1260" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#fff">CL Extension Custom Binary Cache</text>
  <text x="1260" y="220" text-anchor="middle" font-family="monospace" font-size="16" fill="#8b7355">host_type: "cl_extension"</text>

  <!-- Two-column layout for CL Extension -->
  <!-- Left column: Compilation Phase -->
  <rect x="720" y="250" width="520" height="340" rx="12" fill="#fff" stroke="#ffbb62" stroke-width="2"/>
  <text x="980" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#666666">Compilation Phase (Linux)</text>

  <rect x="760" y="310" width="440" height="45" rx="8" fill="#fff8f0" stroke="#ffbb62" stroke-width="2"/>
  <text x="980" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" fill="#666666">1. Load kernel.cl + config.json</text>

  <line x1="980" y1="355" x2="980" y2="370" stroke="#ffbb62" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="760" y="375" width="440" height="45" rx="8" fill="#ffbb62"/>
  <text x="980" y="405" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#fff">2. ClExtensionBuildKernel()</text>

  <line x1="980" y1="420" x2="980" y2="435" stroke="#ffbb62" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="760" y="440" width="440" height="45" rx="8" fill="#fff8f0" stroke="#ffbb62" stroke-width="2"/>
  <text x="980" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" fill="#666666">3. Hardware-specific optimization</text>

  <line x1="980" y1="485" x2="980" y2="500" stroke="#ffbb62" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="760" y="505" width="440" height="60" rx="8" fill="#ffbb62"/>
  <text x="980" y="530" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#fff">4. CacheSaveCustomBinary()</text>
  <text x="980" y="555" text-anchor="middle" font-family="monospace" font-size="14" fill="#fff">â†’ {kernel}_custom.bin</text>

  <!-- Right column: Execution Phase -->
  <rect x="1280" y="250" width="520" height="340" rx="12" fill="#fff" stroke="#ffbb62" stroke-width="2"/>
  <text x="1540" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#666666">Execution Phase (Linux/Android)</text>

  <rect x="1320" y="310" width="440" height="45" rx="8" fill="#fff8f0" stroke="#ffbb62" stroke-width="2"/>
  <text x="1540" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" fill="#666666">1. Load {kernel}_custom.bin</text>

  <line x1="1540" y1="355" x2="1540" y2="370" stroke="#ffbb62" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="1320" y="375" width="440" height="45" rx="8" fill="#ffbb62"/>
  <text x="1540" y="405" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#fff">2. ClExtensionCreateKernel()</text>

  <line x1="1540" y1="420" x2="1540" y2="435" stroke="#ffbb62" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="1320" y="440" width="440" height="45" rx="8" fill="#fff8f0" stroke="#ffbb62" stroke-width="2"/>
  <text x="1540" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" fill="#666666">3. Skip compilation (pre-built)</text>

  <line x1="1540" y1="485" x2="1540" y2="500" stroke="#ffbb62" stroke-width="2" marker-end="url(#arrow)"/>

  <rect x="1320" y="505" width="440" height="60" rx="8" fill="#ffbb62"/>
  <text x="1540" y="530" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#fff">4. ClExtensionEnqueueNdrange()</text>
  <text x="1540" y="555" text-anchor="middle" font-family="monospace" font-size="14" fill="#fff">Vendor extension APIs</text>

  <!-- Arrow between phases -->
  <line x1="1240" y1="420" x2="1280" y2="420" stroke="#666666" stroke-width="4" marker-end="url(#arrow-gray)"/>
  <text x="1260" y="405" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#666666">deploy</text>

  <!-- ============ BOTTOM: Comparison Table ============ -->
  <rect x="80" y="640" width="1760" height="400" rx="20" fill="#ffbb62"/>
  <text x="960" y="690" text-anchor="middle" font-family="Arial, sans-serif" font-size="28" font-weight="bold" fill="#fff">Cache Comparison</text>

  <!-- Table headers -->
  <rect x="120" y="720" width="400" height="50" rx="8" fill="#fff"/>
  <text x="320" y="752" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#666666">Aspect</text>

  <rect x="540" y="720" width="600" height="50" rx="8" fill="#ffe4c4"/>
  <text x="840" y="752" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#cc8800">Standard Cache</text>

  <rect x="1160" y="720" width="640" height="50" rx="8" fill="#fff8f0"/>
  <text x="1480" y="752" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#ffbb62">Custom Binary Cache</text>

  <!-- Row 1: Binary Type -->
  <rect x="120" y="780" width="400" height="45" rx="6" fill="#fff"/>
  <text x="320" y="810" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#666666">Binary Type</text>

  <rect x="540" y="780" width="600" height="45" rx="6" fill="#fff"/>
  <text x="840" y="810" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#666666">JIT-compiled (clBuildProgram)</text>

  <rect x="1160" y="780" width="640" height="45" rx="6" fill="#fff"/>
  <text x="1480" y="810" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#666666">Pre-compiled (vendor-specific)</text>

  <!-- Row 2: Cache Location -->
  <rect x="120" y="835" width="400" height="45" rx="6" fill="#fff"/>
  <text x="320" y="865" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#666666">Cache Files</text>

  <rect x="540" y="835" width="600" height="45" rx="6" fill="#fff"/>
  <text x="840" y="865" text-anchor="middle" font-family="monospace" font-size="16" fill="#666666">{kernel}.bin + {kernel}.hash</text>

  <rect x="1160" y="835" width="640" height="45" rx="6" fill="#fff"/>
  <text x="1480" y="865" text-anchor="middle" font-family="monospace" font-size="16" fill="#666666">{kernel}_custom.bin (optimized)</text>

  <!-- Row 3: Portability -->
  <rect x="120" y="890" width="400" height="45" rx="6" fill="#fff"/>
  <text x="320" y="920" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#666666">Portability</text>

  <rect x="540" y="890" width="600" height="45" rx="6" fill="#fff"/>
  <text x="840" y="920" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#666666">Any OpenCL GPU</text>

  <rect x="1160" y="890" width="640" height="45" rx="6" fill="#fff"/>
  <text x="1480" y="920" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#666666">Specific hardware target</text>

  <!-- Row 4: Performance -->
  <rect x="120" y="945" width="400" height="45" rx="6" fill="#fff"/>
  <text x="320" y="975" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#666666">Performance</text>

  <rect x="540" y="945" width="600" height="45" rx="6" fill="#fff"/>
  <text x="840" y="975" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#666666">Good (generic optimizations)</text>

  <rect x="1160" y="945" width="640" height="45" rx="6" fill="#fff"/>
  <text x="1480" y="975" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#cc8800">Maximum (HW-specific)</text>

  <!-- Code reference -->
  <rect x="120" y="1000" width="1680" height="30" rx="6" fill="#fff"/>
  <text x="960" y="1022" text-anchor="middle" font-family="monospace" font-size="16" fill="#666666">Code: cache_manager.c:324 CacheSaveCustomBinary() | opencl_utils.c:597 (called after ClExtensionEnqueueNdrangeKernel)</text>
</svg>
