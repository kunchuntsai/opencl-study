<!DOCTYPE html>
<html>
<head>
    <title>Download D3.js for Offline Use</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        h1 { color: #333; }
        .status { padding: 15px; border-radius: 5px; margin: 20px 0; }
        .loading { background: #fff3cd; border: 1px solid #ffc107; }
        .success { background: #d4edda; border: 1px solid #28a745; }
        .error { background: #f8d7da; border: 1px solid #dc3545; }
        button { background: #007bff; color: white; padding: 12px 24px; border: none;
                 border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px; }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; }
        pre { background: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .info { color: #666; font-size: 14px; }
    </style>
</head>
<body>
    <h1>D3.js Offline Download Helper</h1>
    <p>This page downloads D3.js v7 and lets you save it for offline use.</p>

    <div id="status" class="status loading">Loading D3.js from CDN...</div>

    <div id="actions" style="display:none;">
        <button onclick="downloadFile()">Download d3.v7.min.js</button>
        <button onclick="copyToClipboard()">Copy to Clipboard</button>
    </div>

    <div id="instructions" style="display:none; margin-top: 30px;">
        <h2>Instructions</h2>
        <ol>
            <li>Click <strong>"Download d3.v7.min.js"</strong> to save the file</li>
            <li>Copy the downloaded file to your analyzer directory:
                <pre>analyzer/d3.v7.min.js</pre>
            </li>
            <li>Generated HTML reports will now work offline!</li>
        </ol>
        <p class="info">File size: <span id="fileSize">-</span></p>
    </div>

    <script>
        let d3Content = '';

        // Try multiple CDNs
        const cdnUrls = [
            'https://d3js.org/d3.v7.min.js',
            'https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js',
            'https://unpkg.com/d3@7/dist/d3.min.js',
            'https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js'
        ];

        async function tryFetch(url) {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            return await response.text();
        }

        async function loadD3() {
            const status = document.getElementById('status');

            for (const url of cdnUrls) {
                try {
                    status.textContent = `Trying ${url}...`;
                    d3Content = await tryFetch(url);

                    if (d3Content.length > 100000) {
                        status.className = 'status success';
                        status.innerHTML = `<strong>Success!</strong> D3.js loaded (${(d3Content.length/1024).toFixed(1)} KB)`;
                        document.getElementById('actions').style.display = 'block';
                        document.getElementById('instructions').style.display = 'block';
                        document.getElementById('fileSize').textContent = `${(d3Content.length/1024).toFixed(1)} KB`;
                        return;
                    }
                } catch (e) {
                    console.log(`Failed: ${url}`, e);
                }
            }

            status.className = 'status error';
            status.innerHTML = '<strong>Error:</strong> Could not load D3.js from any CDN. Check your internet connection.';
        }

        function downloadFile() {
            const blob = new Blob([d3Content], { type: 'application/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'd3.v7.min.js';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function copyToClipboard() {
            navigator.clipboard.writeText(d3Content).then(() => {
                alert('D3.js content copied to clipboard!\n\nPaste it into a file named d3.v7.min.js');
            }).catch(err => {
                alert('Failed to copy: ' + err);
            });
        }

        loadD3();
    </script>
</body>
</html>
